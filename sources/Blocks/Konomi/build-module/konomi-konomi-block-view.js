import{getContext as e,getElement as o,store as r,useLayoutEffect as n}from"@wordpress/interactivity";function t(e){for(;e&&"konomi"!==e.dataset.wpInteractive;)e=e.parentElement;return e}r("konomi",{state:{},actions:{closeLoginModal:()=>{e("konomi").loginRequired=!1}},callbacks:{maybeRenderResponseError:()=>{const r=e("konomi");n(()=>{const e=o();var n;e.ref&&r.error.code&&(n=e.ref,(e=>{const o=function(e){var o;return null!==(o=t(e)?.querySelector(".konomi-response-message"))&&void 0!==o?o:null}(e);return o?Promise.resolve(o):Promise.reject(new Error("Konomi: Popover element not found."))})(n).then(e=>(e.showPopover(),new Promise(o=>{setTimeout(()=>{e.hidePopover(),o()},3e3)})))).finally(()=>{r.error={code:"",message:""}})},[r.error.code,r.error.message])},toggleLoginModal:()=>{const r=o();if(!(r.ref instanceof HTMLElement))return;const n=e("konomi");if(n.isUserLoggedIn)return;const s=function(e){const o=t(e)?.querySelector(".konomi-login-modal");return function(e){if(null==e)throw new Error("Element is not an HTMLDialogElement")}(o),o}(r.ref);n.loginRequired?s.showModal():s.close()}}});