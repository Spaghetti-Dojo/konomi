{"version":3,"file":"konomi-schema.js","mappings":"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","sources":["webpack://konomi/./resources/modules/schema/index.ts","webpack://konomi/external import \"@external/effect-js\"","webpack://konomi/external import \"@external/zod\"","webpack://konomi/external module \"@wordpress/interactivity\"","webpack://konomi/webpack/bootstrap","webpack://konomi/webpack/runtime/async module","webpack://konomi/webpack/runtime/define property getters","webpack://konomi/webpack/runtime/hasOwnProperty shorthand","webpack://konomi/webpack/runtime/make namespace object","webpack://konomi/webpack/before-startup","webpack://konomi/webpack/startup","webpack://konomi/webpack/after-startup"],"sourcesContent":["import type { Cause } from '@external/effect-js';\nimport * as z from '@external/zod';\nimport { Effect, pipe } from '@external/effect-js';\nimport {\n\tgetConfig,\n\tgetContext,\n\tgetServerContext,\n\tgetServerState,\n} from '@wordpress/interactivity';\n\nexport type SanitizationError = Readonly< Cause.Cause< Error > >;\n\n// eslint-disable-next-line @typescript-eslint/max-params\nexport function sanitize< S extends z.ZodType >(\n\tconfiguration: unknown,\n\tschema: S\n): Readonly< Effect.Effect< z.infer< S >, Error > > {\n\treturn Effect.try( {\n\t\ttry: () => schema.parse( configuration ),\n\t\tcatch: ( error ) => {\n\t\t\tif ( error instanceof z.ZodError ) {\n\t\t\t\tconst zodError = z.prettifyError( error );\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`Configuration validation failed: ${ zodError }`\n\t\t\t\t);\n\t\t\t}\n\t\t\tthrow error;\n\t\t},\n\t} );\n}\n\nexport function sanitizeState< S extends z.ZodType >(\n\tschema: S,\n\tstoreName: string,\n\tonError?: ( error: Readonly< Cause.Cause< Error > > ) => void\n): Effect.Effect< z.infer< S >, Cause.Cause< Error > > {\n\treturn pipe(\n\t\tEffect.succeed( getServerState( storeName ) ),\n\t\tEffect.flatMap( ( serverState ) => sanitize( serverState, schema ) ),\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-readonly-parameter-types\n\t\tEffect.catchAllCause( ( error ) =>\n\t\t\tcatchInitializationIssues( error, storeName, onError )\n\t\t)\n\t);\n}\n\nexport function sanitizeContext< S extends z.ZodType >(\n\tschema: S,\n\tstoreName: string,\n\tonError?: ( error: Readonly< Cause.Cause< Error > > ) => void\n): Effect.Effect< null, Cause.Cause< Error > > {\n\treturn pipe(\n\t\tEffect.succeed( getServerContext() ),\n\t\tEffect.flatMap( ( context: any ) => sanitize( context, schema ) ),\n\t\tEffect.tap( ( sanitizedContext ) => {\n\t\t\tconst context = getContext();\n\t\t\tObject.assign( context, sanitizedContext );\n\t\t} ),\n\t\tEffect.andThen( () => null ),\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-readonly-parameter-types\n\t\tEffect.catchAllCause( ( error ) =>\n\t\t\tcatchInitializationIssues( error, storeName, onError )\n\t\t)\n\t);\n}\n\nexport function sanitizeConfiguration< S extends z.ZodType >(\n\tschema: S,\n\tstoreName: string,\n\tonError?: ( error: Readonly< Cause.Cause< Error > > ) => void\n): Effect.Effect< null, Cause.Cause< Error > > {\n\treturn pipe(\n\t\tEffect.succeed( getConfig() ),\n\t\tEffect.flatMap( ( config: any ) => sanitize( config, schema ) ),\n\t\tEffect.tap( ( sanitizedConfig ) => {\n\t\t\tconst config = getConfig();\n\t\t\tObject.assign( config, sanitizedConfig );\n\t\t} ),\n\t\tEffect.andThen( () => null ),\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-readonly-parameter-types\n\t\tEffect.catchAllCause( ( error ) =>\n\t\t\tcatchInitializationIssues( error, storeName, onError )\n\t\t)\n\t);\n}\n\nfunction catchInitializationIssues(\n\terror: Readonly< Cause.Cause< Error > >,\n\t_storeName: string,\n\tcallback?: ( error: Readonly< Cause.Cause< Error > > ) => void\n): Effect.Effect< never, Cause.Cause< Error >, never > {\n\tif ( callback ) {\n\t\tcallback( error );\n\t}\n\n\treturn Effect.fail( error );\n}\n","module.exports = import(\"@external/effect-js\");;","module.exports = import(\"@external/zod\");;","module.exports = __WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","var hasSymbol = typeof Symbol === \"function\";\nvar webpackQueues = hasSymbol ? Symbol(\"webpack queues\") : \"__webpack_queues__\";\nvar webpackExports = hasSymbol ? Symbol(\"webpack exports\") : \"__webpack_exports__\";\nvar webpackError = hasSymbol ? Symbol(\"webpack error\") : \"__webpack_error__\";\n\n\nvar resolveQueue = (queue) => {\n\tif(queue && queue.d < 1) {\n\t\tqueue.d = 1;\n\t\tqueue.forEach((fn) => (fn.r--));\n\t\tqueue.forEach((fn) => (fn.r-- ? fn.r++ : fn()));\n\t}\n}\nvar wrapDeps = (deps) => (deps.map((dep) => {\n\tif(dep !== null && typeof dep === \"object\") {\n\n\t\tif(dep[webpackQueues]) return dep;\n\t\tif(dep.then) {\n\t\t\tvar queue = [];\n\t\t\tqueue.d = 0;\n\t\t\tdep.then((r) => {\n\t\t\t\tobj[webpackExports] = r;\n\t\t\t\tresolveQueue(queue);\n\t\t\t}, (e) => {\n\t\t\t\tobj[webpackError] = e;\n\t\t\t\tresolveQueue(queue);\n\t\t\t});\n\t\t\tvar obj = {};\n\n\t\t\tobj[webpackQueues] = (fn) => (fn(queue));\n\t\t\treturn obj;\n\t\t}\n\t}\n\tvar ret = {};\n\tret[webpackQueues] = x => {};\n\tret[webpackExports] = dep;\n\treturn ret;\n}));\n__webpack_require__.a = (module, body, hasAwait) => {\n\tvar queue;\n\thasAwait && ((queue = []).d = -1);\n\tvar depQueues = new Set();\n\tvar exports = module.exports;\n\tvar currentDeps;\n\tvar outerResolve;\n\tvar reject;\n\tvar promise = new Promise((resolve, rej) => {\n\t\treject = rej;\n\t\touterResolve = resolve;\n\t});\n\tpromise[webpackExports] = exports;\n\tpromise[webpackQueues] = (fn) => (queue && fn(queue), depQueues.forEach(fn), promise[\"catch\"](x => {}));\n\tmodule.exports = promise;\n\tvar handle = (deps) => {\n\t\tcurrentDeps = wrapDeps(deps);\n\t\tvar fn;\n\t\tvar getResult = () => (currentDeps.map((d) => {\n\n\t\t\tif(d[webpackError]) throw d[webpackError];\n\t\t\treturn d[webpackExports];\n\t\t}))\n\t\tvar promise = new Promise((resolve) => {\n\t\t\tfn = () => (resolve(getResult));\n\t\t\tfn.r = 0;\n\t\t\tvar fnQueue = (q) => (q !== queue && !depQueues.has(q) && (depQueues.add(q), q && !q.d && (fn.r++, q.push(fn))));\n\t\t\tcurrentDeps.map((dep) => (dep[webpackQueues](fnQueue)));\n\t\t});\n\t\treturn fn.r ? promise : getResult();\n\t}\n\tvar done = (err) => ((err ? reject(promise[webpackError] = err) : outerResolve(exports)), resolveQueue(queue))\n\tbody(handle, done);\n\tqueue && queue.d < 0 && (queue.d = 0);\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","","// startup\n// Load entry module and return exports\n// This entry module used 'module' so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./resources/modules/schema/index.ts\");\n",""],"names":["z","Effect","pipe","getConfig","getContext","getServerContext","getServerState","sanitize","configuration","schema","try","parse","catch","error","ZodError","zodError","prettifyError","Error","sanitizeState","storeName","onError","succeed","flatMap","serverState","catchAllCause","catchInitializationIssues","sanitizeContext","context","tap","sanitizedContext","Object","assign","andThen","sanitizeConfiguration","config","sanitizedConfig","_storeName","callback","fail"],"sourceRoot":""}